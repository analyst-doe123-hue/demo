{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h3 class="mb-3">Gallery - {{ student["Full Name"] }}</h3>
  <form method="POST" enctype="multipart/form-data" class="mb-4">
    <input type="file" name="gallery_file" class="form-control mb-2" accept="image/*" multiple required>
    <input type="text" name="note" class="form-control mb-2" placeholder="Photo note (applies to all selected)">
    <button type="submit" class="btn btn-maroon">Upload</button>
  </form>

  <div class="d-flex flex-wrap">
    {% for up in uploads %}
      <div class="me-3 mb-3 text-center">
        <img src="{{ up.url }}" class="gallery-img rounded shadow" style="width: 200px; height: auto;">
        <p class="mt-2">{{ up.note }}</p>
        <button class="btn btn-sm btn-danger" onclick="deleteFile('{{ student['Admission Number'] }}', '{{ up.public_id }}', 'gallery', this)">🗑️</button>
      </div>
    {% else %}
      <p>No gallery images uploaded yet.</p>
    {% endfor %}
  </div>
</div>

<script>
function deleteFile(adm_no, public_id, type, btn) {
  if (!confirm("Are you sure you want to delete this file?")) return;
  fetch('/delete_file', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({ adm_no, public_id, type })
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      btn.closest('div').remove();
    } else {
      alert("Error: " + data.error);
    }
  });
}
</script>
{% endblock %}
