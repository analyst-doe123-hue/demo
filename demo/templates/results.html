{% extends "base.html" %}
{% block content %}
<div class="container mt-5">
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-maroon mb-4 rounded">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">📄 Results</a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav me-auto">
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('profile', adm_no=student['Admission Number']) }}">👤 Profile</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('gallery', adm_no=student['Admission Number']) }}">🖼️ Gallery</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Student Info -->
  <div class="card shadow mb-4">
    <div class="card-body">
      <h4 class="text-maroon">{{ student["Full Name"] }}</h4>
      <p><strong>Admission Number:</strong> {{ student["Admission Number"] }}</p>
    </div>
  </div>

  <!-- Academic Scores -->
  <div class="card shadow mb-4">
    <div class="card-body">
      <h5 class="mb-3">📊 Academic Results</h5>
      {% if results %}
        <ul class="list-group mb-3">
          {% for r in results %}
            <li class="list-group-item">{{ r.subject }}: {{ r.score }}</li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="text-muted">No academic results uploaded yet.</p>
      {% endif %}
    </div>
  </div>

  <!-- Result Images Upload -->
  <div class="card shadow mb-4">
    <div class="card-body">
      <h5 class="mb-3">📷 Upload Result Images</h5>
      <form method="POST" action="{{ url_for('upload_result_file', adm_no=student['Admission Number']) }}" enctype="multipart/form-data" class="mb-4">
        <input type="file" name="result_file" class="form-control mb-2" accept="image/*" multiple required>
        <input type="text" name="note" class="form-control mb-2" placeholder="Optional note about the result">
        <button type="submit" class="btn btn-maroon">Upload</button>
      </form>

      <!-- Display Uploaded Result Images -->
      {% if result_images %}
        <div class="row">
          {% for file in result_images %}
            <div class="col-md-4 col-sm-6 mb-4 text-center">
              <img src="{{ file.url }}" alt="Result Image" class="img-fluid rounded shadow-sm">
              {% if file.note %}
                <p class="mt-2 small">{{ file.note }}</p>
              {% endif %}
              <button class="btn btn-sm btn-danger mt-1" onclick="deleteFile('{{ student['Admission Number'] }}', '{{ file.public_id }}', 'result', this)">🗑️ Delete</button>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p class="text-muted">No result images uploaded yet.</p>
      {% endif %}
    </div>
  </div>
</div>

<script>
function deleteFile(adm_no, public_id, type, btn) {
  if (!confirm("Are you sure you want to delete this file?")) return;
  fetch('/delete_file', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({ adm_no, public_id, type })
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      btn.closest('.col-md-4').remove();
    } else {
      alert("Error: " + data.error);
    }
  });
}
</script>
{% endblock %}
